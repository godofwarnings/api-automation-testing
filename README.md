
# Playwright API Testing Framework

## Directory Structure

```bash
├── .github/
│   └── workflows/
│       └── main.yml              # CI/CD workflow
├── config/                       # Centralized configuration
│   ├── environments.yml          # Central config for envs, partners, credentials
│   └── data-variance/            #TODO Future - Configs for the test generation engine
│       └── bop/
├── .auth/                        # Stores the authentication state file (gitignored)
│   └── state.json                # Will be generated by globalSetup when the authentication is successful
├── payloads/
│   ├── _generated_/              # Generated XML payloads (gitignored)
│   └── login-success.xml
├── reports/
│   ├── allure-report/
│   └── allure-results/
├── src/
│   ├── core/
│   │   ├── test-executor.ts      #
│   │   └── test-generator.ts     # Test Generation Engine
│   └── helpers/
│       └── auth-handler.ts       # read token from file
├── templates/                    # Base templates for payload generation
│   └── bop/
├── tests/
│   ├── globalSetup.ts            # Playwright global setup for auth
│   └── products/                 # Organize tests by product
│       └── bop/
│           ├── _generated_/      #TODO Future - Generated YAML/JSON test files
│           ├── expected/
│           │   └── createQuote.json
│           ├── definitions/
│           │   └── createQuote.yml
│           └── specs/
│               └── createQuote.spec.ts # The "glue" file for BOP createQuote tests
├── .env                          #
├── .gitignore                    #
├── package.json                  #
├── playwright.config.ts          #
└── tsconfig.json                 #
```

## **How to Run It**

* **Install Dependencies:**

```bash
npm install --save-dev @playwright/test typescript @types/node @types/js-yaml js-yaml dotenv allure-playwright yargs @types/yargs cross-env ts-node
```

* **Install Playwright browser dependencies:**

```bash
npx playwright install --with-deps
```

* For Linux (Arch Linux):

```bash
yay -S playwright
```

* **Install allure commandline version**

  * For Linux (Debian/Ubuntu):
  
  ```bash
  sudo apt-get install allure
  ```

  * For Windows:

  ```powershell
  Set-ExecutionPolicy -ExecutionPolicy RemoteSigned -Scope CurrentUser
  Invoke-RestMethod -Uri https://get.scoop.sh | Invoke-Expression
  npm install -g allure-commandline --save-dev
  ```

* **Generate Tests**

(works in linux)
```bash
npm run generate:tests -- --product=bop --api=createQuote
```

(works in windows)
```bash
npm run generate:tests -- -- --product=bop --api=createQuote
```

The issue is that for some reason in windows, the first `--` is taken for the default arguements of npm run, so we need to add an extra `--` before the arguments.

e.g.

```bash
npm run generate:tests -- --verbose -- --product=bop --api=createQuote
```

(runs in both linux and windows)

```bash
npx ts-node src/core/test-generator.ts --product=bop --api=createQuote
```

* **Run the API tests for a specific partner (e.g., Partner A):**

```bash
npm run test:sit:partner_a
```

* **Generate and view the Allure report:**

```bash
npm run report:allure
```

## Additional Information

### Installing pip (windows) on restricted networks

If you are on a restricted network and need to install some pip packages, say `ruamel.yaml`, you can use the following command

```powershell
pip install --trusted-host pypi.org --trusted-host pypi.python.org --trusted-host files.pythonhosted.org ruamel.yaml
```
